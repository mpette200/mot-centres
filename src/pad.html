<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Test Pad</title>
  <link rel="stylesheet" href="gen_web.css" type="text/css"/>
  <script src="postcodes.js"
  type="text/javascript"></script>
</head>

<body>
<h3>Test Pad</h3>
</br>
<div>
  <input type="text" id="box_in" name="fnbox" size="35" placeholder="Info">
  <button id="btn_proc">Get Info</button>
  
  <textarea readonly id="txt_out" rows=20 columns=80></textarea>
</div>

<script>
'use strict';

var pcd = postcodeLib;

var box_in = document.getElementById('box_in');
var btn_proc = document.getElementById('btn_proc');
var txt_out = document.getElementById('txt_out');

var show_result = function (msg) {
  return function() { txt_out.value = msg; };
};

var btn_handler = function btn() {
  var path = 'data/codepoint/Data/';
  var query = box_in.value;
  var out = txt_out;
  var url = path + pcd.getPrefix(query) + '.dat';
  var req = new XMLHttpRequest();
  req.open('GET', url, true);
  req.send();
  req.onreadystatechange = function () {
    if (req.status == 200) {
      var rows = req.responseText;
      out.value = pcd.parseCoordinates(rows).east;
      out.value = rows.indexOf(query.toUpperCase());
    } else {
      out.value = `Error ${req.status} ${req.statusText}`;
    }
  };
};

btn_proc.onclick = btn_handler;

</script>
</body>
</html>
